<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subsetting Tables â€¢ rtables</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Subsetting Tables">
<meta property="og:description" content="rtables">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtables</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/roche/rtables">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Subsetting Tables</h1>
                        <h4 class="author">Gabriel Becker and Adrian Waddell</h4>
            
            <h4 class="date">2021-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/roche/rtables/blob/master/vignettes/subsetting_tables.Rmd"><code>vignettes/subsetting_tables.Rmd</code></a></small>
      <div class="hidden name"><code>subsetting_tables.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.reveal .r code {
    white-space: pre;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>TableTree</code> objects are based on a tree data structure as the name indicates. The package is written such that the user does not need to walk trees for many basic table manipulations. Walking trees will still be necessary for certain manipulation and will be the subject of a different vignette.</p>
<p>In this vignette we show some methods to subset tables and to extract cell values.</p>
<p>We will use the following table for illustrative purposes:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rtables</span>)</pre></body></html></div>
<pre><code>Loading required package: magrittr</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
<pre><code>
Attaching package: 'dplyr'</code></pre>
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"STRATA1"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ex_adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))

<span class="no">tbl</span></pre></body></html></div>
<pre><code>            A: Drug X   B: Placebo   C: Combination
---------------------------------------------------
F                                                  
  AGE                                              
    Mean      32.76       34.12           35.2     
  STRATA1                                          
    A          21           24             18      
    B          25           27             21      
    C          33           26             27      
M                                                  
  AGE                                              
    Mean      35.57       37.44          35.38     
  STRATA1                                          
    A          16           19             20      
    B          21           17             21      
    C          14           19             19      </code></pre>
<p>The <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> accessor function always returns an <code>TableTree</code> object if <code>drop=TRUE</code> is not set. The first argument are the row indices and the second argument the column indices. Alternatively logical subsetting can be used. The indices are based on visible rows and not on the tree structure. So:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">tbl</span>[<span class="fl">1</span>, <span class="fl">1</span>]</pre></body></html></div>
<pre><code>    A: Drug X
-------------
F            </code></pre>
<p>is a table with an empty cell because the first row is a label row. We need to access a cell with actual cell data:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">tbl</span>[<span class="fl">3</span>, <span class="fl">1</span>]</pre></body></html></div>
<pre><code>       A: Drug X
----------------
Mean     32.76  </code></pre>
<p>which is another <code>TableTree</code> and not an <code>rcell</code>. If we wanted the <code>rcell</code> we need to use the <code>drop</code> argument:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">tbl</span>[<span class="fl">3</span>, <span class="fl">1</span>, <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">TRUE</span>]</pre></body></html></div>
<pre><code>[1] 32.75949</code></pre>
<p>One can access multiple rows and columns:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">tbl</span>[<span class="fl">1</span>:<span class="fl">3</span>, <span class="fl">1</span>:<span class="fl">2</span>]</pre></body></html></div>
<pre><code>           A: Drug X   B: Placebo
---------------------------------
F                                
  AGE                            
    Mean     32.76       34.12   </code></pre>
<p>Note that we do not repeat label rows for descending children, e.g.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">tbl</span>[<span class="fl">2</span>:<span class="fl">4</span>, ]</pre></body></html></div>
<pre><code>          A: Drug X   B: Placebo   C: Combination
-------------------------------------------------
AGE                                              
  Mean      32.76       34.12           35.2     
STRATA1                                          </code></pre>
<p>does not show that the first row is derived from <code>AGE</code>. In order to repeat content/label information one should use the pagination feature. Please read the related vignette.</p>
</div>
<div id="path-based-cell-value-accessing" class="section level2">
<h2 class="hasAnchor">
<a href="#path-based-cell-value-accessing" class="anchor"></a>Path Based Cell Value Accessing:</h2>
<p>Cell values can also be access via path information. The functions <code>row_paths</code>, <code>col_paths</code>, <code>row_paths_summary</code>, <code>col_paths_summary</code> are helpful to get information on the paths.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">tbl2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"STRATA1"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ex_adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))

<span class="no">tbl2</span></pre></body></html></div>
<pre><code>            A: Drug X      B: Placebo      C: Combination  
            F       M       F       M        F         M   
-----------------------------------------------------------
AGE                                                        
  Mean    32.76   35.57   34.12   37.44    35.2      35.38 
STRATA1                                                    
  A        21      16      24      19       18        20   
  B        25      21      27      17       21        21   
  C        33      14      26      19       27        19   </code></pre>
<p>So the column paths are as follows:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/row_paths_summary.html">col_paths_summary</a></span>(<span class="no">tbl2</span>)</pre></body></html></div>
<pre><code>label             path                       
---------------------------------------------
A: Drug X         ARM, A: Drug X             
  F               ARM, A: Drug X, SEX, F     
  M               ARM, A: Drug X, SEX, M     
B: Placebo        ARM, B: Placebo            
  F               ARM, B: Placebo, SEX, F    
  M               ARM, B: Placebo, SEX, M    
C: Combination    ARM, C: Combination        
  F               ARM, C: Combination, SEX, F
  M               ARM, C: Combination, SEX, M</code></pre>
<p>and the row paths are as follows:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/row_paths_summary.html">row_paths_summary</a></span>(<span class="no">tbl2</span>)</pre></body></html></div>
<pre><code>rowname    node_class    path      
-----------------------------------
AGE        LabelRow      AGE       
  Mean     DataRow       AGE, Mean 
STRATA1    LabelRow      STRATA1   
  A        DataRow       STRATA1, A
  B        DataRow       STRATA1, B
  C        DataRow       STRATA1, C</code></pre>
<p>So in order to get the average age for all female patients in arm <code>A: Drug X</code>:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/cell_values.html">value_at</a></span>(<span class="no">tbl2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>,  <span class="st">"Mean"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ARM"</span>, <span class="st">"A: Drug X"</span>, <span class="st">"SEX"</span>, <span class="st">"F"</span>))</pre></body></html></div>
<pre><code>[1] 32.75949</code></pre>
<p>You can also request information from non-cell specific paths with the <code>cell_values</code> function:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/cell_values.html">cell_values</a></span>(<span class="no">tbl2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"Mean"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ARM"</span>, <span class="st">"A: Drug X"</span>))</pre></body></html></div>
<pre><code>$`A: Drug X.F`
[1] 32.75949

$`A: Drug X.M`
[1] 35.56863</code></pre>
<p>Note the return value of <code>cell_values</code> is always a list even if you specify a path to a cell:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/cell_values.html">cell_values</a></span>(<span class="no">tbl2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>,  <span class="st">"Mean"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ARM"</span>, <span class="st">"A: Drug X"</span>, <span class="st">"SEX"</span>, <span class="st">"F"</span>))</pre></body></html></div>
<pre><code>$`A: Drug X.F`
[1] 32.75949</code></pre>
<p>Hence, use <code>value_at</code> if you want to access data from a cell, and <code>cell_values</code> if you want to access data from multiple cells.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gabriel Becker, Adrian Waddell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
