<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example Clinical Trials Tables • rtables</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example Clinical Trials Tables">
<meta property="og:description" content="rtables">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtables</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/roche/rtables">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example Clinical Trials Tables</h1>
                        <h4 class="author">Gabriel Becker and Adrian Waddell</h4>
            
            <h4 class="date">2021-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/roche/rtables/blob/master/vignettes/clinical_trials.Rmd"><code>vignettes/clinical_trials.Rmd</code></a></small>
      <div class="hidden name"><code>clinical_trials.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.reveal .r code {
    white-space: pre;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this vignette we create a</p>
<ul>
<li>demographic table</li>
<li>adverse event table</li>
<li>response table</li>
</ul>
<p>using the <code>rtables</code> layout facility. That is, we demonstrate how the layout based tabulation framework can specify the structure and relations that are commonly found when analyzing clinical trials data.</p>
<p>Note that all the data is created using random number generators. All <code>ex_*</code> data which is currently attached to the <code>rtables</code> package were created using <code>random.cdisc.data</code> another R package that we intend to release as open source soon.</p>
<p>The packages used in this vignette are:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rtables</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
</div>
<div id="demographic-table" class="section level2">
<h2 class="hasAnchor">
<a href="#demographic-table" class="anchor"></a>Demographic Table</h2>
<p>Demographic tables summarize the variables content for different population subsets (encoded in the columns).</p>
<p>One feature of <code>analyze</code> that we have not introduced in the previous vignette is that the analysis function <code>afun</code> can specify multiple rows with the <code>in_rows</code> function:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ADSL</span> <span class="kw">&lt;-</span> <span class="no">ex_adsl</span>  <span class="co"># Example ADSL dataset</span>

<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="kw">vars</span> <span class="kw">=</span> <span class="st">"AGE"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="st">"Mean (sd)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>)), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx)"</span>),
      <span class="st">"Range"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">x</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx - xx.xx"</span>)
    )
  }) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>             A: Drug X     B: Placebo    C: Combination
-------------------------------------------------------
Mean (sd)   33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
Range         21 - 50        21 - 62        20 - 69    </code></pre>
<p>Multiple variables can be analyzed in one <code>analyze</code> call:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="kw">vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR1"</span>), <span class="kw">afun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="st">"Mean (sd)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>)), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx)"</span>),
      <span class="st">"Range"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">x</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx - xx.xx"</span>)
    )
  }) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>               A: Drug X      B: Placebo    C: Combination
----------------------------------------------------------
AGE                                                       
  Mean (sd)   33.77 (6.55)   35.43 (7.9)     35.43 (7.72) 
  Range         21 - 50        21 - 62         20 - 69    
BMRKR1                                                    
  Mean (sd)   5.97 (3.55)     5.7 (3.31)     5.62 (3.49)  
  Range       0.41 - 17.67   0.65 - 14.24    0.17 - 21.39 </code></pre>
<p>Hence, if <code>afun</code> can process different data vector types (i.e. variables selected from the data) then we are fairly close to a standard demographic table. Here is a function that either creates a count table or some number summary if the argument <code>x</code> is a factor or numeric, respectively:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">s_summary</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span>(<span class="no">x</span>)) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="st">"n"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>)), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx"</span>),
      <span class="st">"Mean (sd)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx)"</span>),
      <span class="st">"IQR"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx"</span>),
      <span class="st">"min - max"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx - xx.xx"</span>)
    )
  } <span class="kw">else</span> <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/factor.html">is.factor</a></span>(<span class="no">x</span>)) {

    <span class="no">vs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">x</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">in_rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">vs</span>, <span class="no">rcell</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx"</span>))

  } <span class="kw">else</span> (
    <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"type not supported"</span>)
  )
}</pre></body></html></div>
<p>Note we use <code>rcell</code>s to wrap the results in order to add formatting instructions for <code>rtables</code>. We can use <code>s_summary</code> outside the context of tabulation:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">s_summary</span>(<span class="no">ADSL</span>$<span class="no">AGE</span>)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
   row_name formatted_cell indent_mod row_label
1         n            400          0         n
2 Mean (sd)   34.88 (7.44)          0 Mean (sd)
3       IQR             10          0       IQR
4 min - max        20 - 69          0 min - max</code></pre>
<p>and</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">s_summary</span>(<span class="no">ADSL</span>$<span class="no">SEX</span>)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
          row_name formatted_cell indent_mod        row_label
1                F            222          0                F
2                M            166          0                M
3                U              9          0                U
4 UNDIFFERENTIATED              3          0 UNDIFFERENTIATED</code></pre>
<p>We can now create a commonly used variant of the demographic table:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">lyt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"SEX"</span>), <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_summary</span>)

<span class="no">tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">lyt</span>, <span class="no">ADSL</span>)
<span class="no">tbl</span></pre></body></html></div>
<pre><code>                      A: Drug X     B: Placebo    C: Combination
----------------------------------------------------------------
AGE                                                             
  n                      134            134            132      
  Mean (sd)          33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
  IQR                     11            10              10      
  min - max            21 - 50        21 - 62        20 - 69    
SEX                                                             
  F                       79            77              66      
  M                       51            55              60      
  U                       3              2              4       
  UNDIFFERENTIATED        1              0              2       </code></pre>
<p>Note that <code>analyze</code> can also be called multiple times in sequence:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">tbl2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"SEX"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)

<span class="no">tbl2</span></pre></body></html></div>
<pre><code>                      A: Drug X     B: Placebo    C: Combination
----------------------------------------------------------------
AGE                                                             
  n                      134            134            132      
  Mean (sd)          33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
  IQR                     11            10              10      
  min - max            21 - 50        21 - 62        20 - 69    
SEX                                                             
  F                       79            77              66      
  M                       51            55              60      
  U                       3              2              4       
  UNDIFFERENTIATED        1              0              2       </code></pre>
<p>which leads to the identical table as <code>tbl</code>:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">tbl</span>, <span class="no">tbl2</span>)</pre></body></html></div>
<pre><code>[1] TRUE</code></pre>
<p>In clinical trials analyses the number of patients per column is often referred to as <code>N</code> (rather than the overall population which outside of clinical trials is commonly referred to as <code>N</code>). Column <code>N</code>s are added using the <code>add_colcounts</code> function:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARMCD"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"SEX"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>                        ARM A          ARM B         ARM C    
                       (N=134)        (N=134)       (N=132)   
--------------------------------------------------------------
AGE                                                           
  n                      134            134           132     
  Mean (sd)          33.77 (6.55)   35.43 (7.9)   35.43 (7.72)
  IQR                     11            10             10     
  min - max            21 - 50        21 - 62       20 - 69   
SEX                                                           
  F                       79            77             66     
  M                       51            55             60     
  U                       3              2             4      
  UNDIFFERENTIATED        1              0             2      </code></pre>
<div id="variations-on-the-demographic-table" class="section level3">
<h3 class="hasAnchor">
<a href="#variations-on-the-demographic-table" class="anchor"></a>Variations on the demographic table</h3>
<p>We will now show a couple of variations of the demographic table that we developed above. These variations are in structure and not in analysis, hence they don’t require a modification to the <code>s_summary</code> function.</p>
<p>We will start with a standard table analyzing the variables <code>AGE</code> and <code>BMRKR2</code> variables:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>               A: Drug X     B: Placebo    C: Combination
                (N=134)        (N=134)        (N=132)    
---------------------------------------------------------
AGE                                                      
  n               134            134            132      
  Mean (sd)   33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
  IQR              11            10              10      
  min - max     21 - 50        21 - 62        20 - 69    
BMRKR2                                                   
  LOW              50            45              40      
  MEDIUM           37            56              42      
  HIGH             47            33              50      </code></pre>
<p>Assume we would like to have this analysis carried out per gender encoded in the row space:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>                    A: Drug X      B: Placebo    C: Combination
                     (N=134)        (N=134)         (N=132)    
---------------------------------------------------------------
F                                                              
  AGE                                                          
    n                   79             77              66      
    Mean (sd)      32.76 (6.09)   34.12 (7.06)    35.2 (7.43)  
    IQR                 9              8              6.75     
    min - max        21 - 47        23 - 58         21 - 64    
  BMRKR2                                                       
    LOW                 26             21              26      
    MEDIUM              21             38              17      
    HIGH                32             18              23      
M                                                              
  AGE                                                          
    n                   51             55              60      
    Mean (sd)      35.57 (7.08)   37.44 (8.69)    35.38 (8.24) 
    IQR                 11             9               11      
    min - max        23 - 50        21 - 62         20 - 69    
  BMRKR2                                                       
    LOW                 21             23              11      
    MEDIUM              15             18              23      
    HIGH                15             14              26      
U                                                              
  AGE                                                          
    n                   3              2               4       
    Mean (sd)      31.67 (3.21)    31 (5.66)      35.25 (3.1)  
    IQR                 3              4              3.25     
    min - max        28 - 34        27 - 35         31 - 38    
  BMRKR2                                                       
    LOW                 2              1               1       
    MEDIUM              1              0               2       
    HIGH                0              1               1       
UNDIFFERENTIATED                                               
  AGE                                                          
    n                   1              0               2       
    Mean (sd)        28 (NA)        NaN (NA)       45 (1.41)   
    IQR                 0              NA              1       
    min - max        28 - 28       Inf - -Inf       44 - 46    
  BMRKR2                                                       
    LOW                 1              0               2       
    MEDIUM              0              0               0       
    HIGH                0              0               0       </code></pre>
<p>We will now subset <code>ADSL</code> to include only males and females in the analysis in order to reduces the number of rows in the table:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">ADSL_M_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ADSL</span>, <span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>))

<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL_M_F</span>)</pre></body></html></div>
<pre><code>                    A: Drug X      B: Placebo    C: Combination
                     (N=130)        (N=132)         (N=126)    
---------------------------------------------------------------
F                                                              
  AGE                                                          
    n                   79             77              66      
    Mean (sd)      32.76 (6.09)   34.12 (7.06)    35.2 (7.43)  
    IQR                 9              8              6.75     
    min - max        21 - 47        23 - 58         21 - 64    
  BMRKR2                                                       
    LOW                 26             21              26      
    MEDIUM              21             38              17      
    HIGH                32             18              23      
M                                                              
  AGE                                                          
    n                   51             55              60      
    Mean (sd)      35.57 (7.08)   37.44 (8.69)    35.38 (8.24) 
    IQR                 11             9               11      
    min - max        23 - 50        21 - 62         20 - 69    
  BMRKR2                                                       
    LOW                 21             23              11      
    MEDIUM              15             18              23      
    HIGH                15             14              26      
U                                                              
  AGE                                                          
    n                   0              0               0       
    Mean (sd)        NaN (NA)       NaN (NA)        NaN (NA)   
    IQR                 NA             NA              NA      
    min - max       Inf - -Inf     Inf - -Inf      Inf - -Inf  
  BMRKR2                                                       
    LOW                 0              0               0       
    MEDIUM              0              0               0       
    HIGH                0              0               0       
UNDIFFERENTIATED                                               
  AGE                                                          
    n                   0              0               0       
    Mean (sd)        NaN (NA)       NaN (NA)        NaN (NA)   
    IQR                 NA             NA              NA      
    min - max       Inf - -Inf     Inf - -Inf      Inf - -Inf  
  BMRKR2                                                       
    LOW                 0              0               0       
    MEDIUM              0              0               0       
    HIGH                0              0               0       </code></pre>
<p>Note that the <code>UNDIFFERENTIATED</code> and <code>U</code> levels still show up in the table. This is because tabulation respects the factor levels and level order, exactly as the <code>split</code> and <code>table</code> function do. If empty levels should be dropped then <code>rtables</code> needs to know that at splitting time via the <code>split_fun</code> argument in <code>split_rows_by</code>. There are a number of predefined functions. For this example <code>drop_split_levels</code> is required to drop the empty levels at splitting time. Splitting is a big topic and will be eventually addressed in a specific package vignette.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL_M_F</span>)</pre></body></html></div>
<pre><code>                 A: Drug X      B: Placebo    C: Combination
                  (N=130)        (N=132)         (N=126)    
------------------------------------------------------------
F                                                           
  AGE                                                       
    n                79             77              66      
    Mean (sd)   32.76 (6.09)   34.12 (7.06)    35.2 (7.43)  
    IQR              9              8              6.75     
    min - max     21 - 47        23 - 58         21 - 64    
  BMRKR2                                                    
    LOW              26             21              26      
    MEDIUM           21             38              17      
    HIGH             32             18              23      
M                                                           
  AGE                                                       
    n                51             55              60      
    Mean (sd)   35.57 (7.08)   37.44 (8.69)    35.38 (8.24) 
    IQR              11             9               11      
    min - max     23 - 50        21 - 62         20 - 69    
  BMRKR2                                                    
    LOW              21             23              11      
    MEDIUM           15             18              23      
    HIGH             15             14              26      </code></pre>
<p>In the table above the labels <code>M</code> and <code>F</code> are not very descriptive. You can add the full label as follows:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">ADSL_M_F_l</span> <span class="kw">&lt;-</span> <span class="no">ADSL_M_F</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lbl_sex</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
    <span class="no">SEX</span> <span class="kw">==</span> <span class="st">"M"</span> ~ <span class="st">"Male"</span>,
    <span class="no">SEX</span> <span class="kw">==</span> <span class="st">"F"</span> ~ <span class="st">"Female"</span>,
    <span class="no">SEX</span> <span class="kw">==</span> <span class="st">"U"</span> ~ <span class="st">"Unknown"</span>,
    <span class="no">SEX</span> <span class="kw">==</span> <span class="st">"UNDIFFERENTIATED"</span> ~ <span class="st">"Undifferentiated"</span>
  ))

<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"BMRKR2"</span>), <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL_M_F_l</span>)</pre></body></html></div>
<pre><code>                 A: Drug X      B: Placebo    C: Combination
                  (N=130)        (N=132)         (N=126)    
------------------------------------------------------------
Female                                                      
  AGE                                                       
    n                79             77              66      
    Mean (sd)   32.76 (6.09)   34.12 (7.06)    35.2 (7.43)  
    IQR              9              8              6.75     
    min - max     21 - 47        23 - 58         21 - 64    
  BMRKR2                                                    
    LOW              26             21              26      
    MEDIUM           21             38              17      
    HIGH             32             18              23      
Male                                                        
  AGE                                                       
    n                51             55              60      
    Mean (sd)   35.57 (7.08)   37.44 (8.69)    35.38 (8.24) 
    IQR              11             9               11      
    min - max     23 - 50        21 - 62         20 - 69    
  BMRKR2                                                    
    LOW              21             23              11      
    MEDIUM           15             18              23      
    HIGH             15             14              26      </code></pre>
<p>For the next table variation we only stratify by gender for the <code>AGE</code> analysis. To do this the <code>nested</code> argument has to be set to <code>FALSE</code> in <code>analyze</code> call:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"BMRKR2"</span>, <span class="no">s_summary</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>,  <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADSL_M_F_l</span>)</pre></body></html></div>
<pre><code>                 A: Drug X      B: Placebo    C: Combination
                  (N=130)        (N=132)         (N=126)    
------------------------------------------------------------
Female                                                      
  AGE                                                       
    n                79             77              66      
    Mean (sd)   32.76 (6.09)   34.12 (7.06)    35.2 (7.43)  
    IQR              9              8              6.75     
    min - max     21 - 47        23 - 58         21 - 64    
Male                                                        
  AGE                                                       
    n                51             55              60      
    Mean (sd)   35.57 (7.08)   37.44 (8.69)    35.38 (8.24) 
    IQR              11             9               11      
    min - max     23 - 50        21 - 62         20 - 69    
BMRKR2                                                      
  LOW                47             44              37      
  MEDIUM             36             56              40      
  HIGH               47             32              49      </code></pre>
<p>Once we split the rows into groups (<code>Male</code> and <code>Female</code> here) one might want to summarize groups: usually by showing count and column percentages. This is especially important if we have missing data. For example if we create the above table but add missing data to the <code>AGE</code> variable:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">insert_NAs</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">x</span>[<span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>, <span class="fl">FALSE</span>), <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>), <span class="fl">TRUE</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>))] <span class="kw">&lt;-</span> <span class="fl">NA</span>
  <span class="no">x</span>
}

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">ADSL_NA</span> <span class="kw">&lt;-</span> <span class="no">ADSL_M_F_l</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">AGE</span> <span class="kw">=</span> <span class="fu">insert_NAs</span>(<span class="no">AGE</span>))

<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"BMRKR2"</span>, <span class="no">s_summary</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>,  <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ADSL_NA</span>, <span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))</pre></body></html></div>
<pre><code>               A: Drug X      B: Placebo    C: Combination
                (N=130)        (N=132)         (N=126)    
----------------------------------------------------------
Female                                                    
  n                65             61              54      
  Mean (sd)   32.71 (6.07)   34.33 (7.31)    34.61 (6.78) 
  IQR              9              10             6.75     
  min - max     21 - 47        23 - 58         21 - 54    
Male                                                      
  n                44             44              50      
  Mean (sd)   35.66 (6.78)   36.93 (8.18)    35.64 (8.42) 
  IQR             10.5           8.25           10.75     
  min - max     24 - 48        21 - 58         20 - 69    
BMRKR2                                                    
  LOW              47             44              37      
  MEDIUM           36             56              40      
  HIGH             47             32              49      </code></pre>
<p>Here it is not easy to see how many females and males there are in each arm as <code>n</code> represents the number of non-missing data elements in the variables. Groups within rows that are defined by splitting can be summarized with <code>summarize_row_groups</code>, for example:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>()  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"BMRKR2"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_summary</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>,  <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ADSL_NA</span>, <span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))</pre></body></html></div>
<pre><code>               A: Drug X      B: Placebo    C: Combination
                (N=130)        (N=132)         (N=126)    
----------------------------------------------------------
Female         79 (60.8%)     77 (58.3%)      66 (52.4%)  
  n                65             61              54      
  Mean (sd)   32.71 (6.07)   34.33 (7.31)    34.61 (6.78) 
  IQR              9              10             6.75     
  min - max     21 - 47        23 - 58         21 - 54    
Male           51 (39.2%)     55 (41.7%)      60 (47.6%)  
  n                44             44              50      
  Mean (sd)   35.66 (6.78)   36.93 (8.18)    35.64 (8.42) 
  IQR             10.5           8.25           10.75     
  min - max     24 - 48        21 - 58         20 - 69    
BMRKR2                                                    
  LOW              47             44              37      
  MEDIUM           36             56              40      
  HIGH             47             32              49      </code></pre>
<p>There are a couple of things to note here.</p>
<ul>
<li>Group summaries produce “content” rows. Visually it’s impossible to distinguish data rows from content rows. Their difference is justified (and it’s an important design decision) because when we paginate tables the content rows are by default repeated if a group gets divided via pagination.</li>
<li>Conceptually the content rows summarize the patient population which is analyzed and hence is often the count &amp; group percentages (default behavior of <code>summarize_row_groups</code>).</li>
</ul>
<p>We can recreate this default behavior (count percentage) by defining a <code>cfun</code> for illustrative purposes here as it results in the same table as above:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="kw">cfun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">labelstr</span>, <span class="no">.N_col</span>, <span class="no">...</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df</span>) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx (xx.xx%)"</span>),
      <span class="kw">.labels</span> <span class="kw">=</span> <span class="no">labelstr</span>
    )
  })  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"BEP01FL"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_summary</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>,  <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ADSL_NA</span>, <span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))</pre></body></html></div>
<pre><code>               A: Drug X      B: Placebo    C: Combination
                (N=130)        (N=132)         (N=126)    
----------------------------------------------------------
Female        79 (60.77%)    77 (58.33%)     66 (52.38%)  
  n                65             61              54      
  Mean (sd)   32.71 (6.07)   34.33 (7.31)    34.61 (6.78) 
  IQR              9              10             6.75     
  min - max     21 - 47        23 - 58         21 - 54    
Male          51 (39.23%)    55 (41.67%)     60 (47.62%)  
  n                44             44              50      
  Mean (sd)   35.66 (6.78)   36.93 (8.18)    35.64 (8.42) 
  IQR             10.5           8.25           10.75     
  min - max     24 - 48        21 - 58         20 - 69    
BEP01FL                                                   
  Y                67             63              65      
  N                63             69              61      </code></pre>
<p>Note that <code>cfun</code> differs from <code>afun</code> (which is used in <code>analyze</code>) in that <code>cfun</code> does not operate on variables but rather on <code>data.frame</code>s or <code>tibble</code>s which are passed via the <code>df</code> argument (<code>afun</code> can optionally request <code>df</code> too). Further, <code>cfun</code> gives the default group label (factor level from splitting) as an argument to <code>labelstr</code> and hence it could be modified:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"SEX"</span>, <span class="kw">labels_var</span> <span class="kw">=</span> <span class="st">"lbl_sex"</span>, <span class="kw">split_fun</span> <span class="kw">=</span> <span class="no">drop_split_levels</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="kw">cfun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">labelstr</span>, <span class="no">.N_col</span>, <span class="no">...</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
       <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df</span>) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx (xx.xx%)"</span>),
       <span class="kw">.labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">labelstr</span>, <span class="st">": count (perc.)"</span>)
    )
  })  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AGE"</span>, <span class="no">s_summary</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"BEP01FL"</span>, <span class="no">s_summary</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ADSL_NA</span>, <span class="no">SEX</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M"</span>, <span class="st">"F"</span>)))</pre></body></html></div>
<pre><code>                         A: Drug X      B: Placebo    C: Combination
--------------------------------------------------------------------
Female: count (perc.)   79 (60.77%)    77 (58.33%)     66 (52.38%)  
  n                          65             61              54      
  Mean (sd)             32.71 (6.07)   34.33 (7.31)    34.61 (6.78) 
  IQR                        9              10             6.75     
  min - max               21 - 47        23 - 58         21 - 54    
Male: count (perc.)     51 (39.23%)    55 (41.67%)     60 (47.62%)  
  n                          44             44              50      
  Mean (sd)             35.66 (6.78)   36.93 (8.18)    35.64 (8.42) 
  IQR                       10.5           8.25           10.75     
  min - max               24 - 48        21 - 58         20 - 69    
BEP01FL                                                             
  Y                          67             63              65      
  N                          63             69              61      </code></pre>
</div>
<div id="using-layouts" class="section level3">
<h3 class="hasAnchor">
<a href="#using-layouts" class="anchor"></a>Using Layouts</h3>
<p>Layouts have a couple of advantages over tabulating the tables directly:</p>
<ul>
<li>the creation of layouts requires the analyst to describe the problem in an abstract way
<ul>
<li>i.e. they separate the analyses description from the actual data</li>
</ul>
</li>
<li>referencing variable names happens via strings (no non-standard evaluation (NSE) is needed, though this is arguably either feature or a short coming)</li>
<li>layouts can be reused</li>
</ul>
<p>Here is an example that demonstrates the reusability of layouts:</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">lyt</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AGE"</span>, <span class="st">"SEX"</span>), <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_summary</span>)

<span class="no">lyt</span></pre></body></html></div>
<pre><code>A Pre-data Table Layout

Column-Split Structure:
ARM (lvls) 

Row-Split Structure:
( (** multivar analysis **) -&gt; AGE, SEX (** multivar analysis **) -&gt; ) (** multivar analysis **) </code></pre>
<p>We can now build a table for <code>ADSL</code></p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">lyt</span>, <span class="no">ADSL</span>)</pre></body></html></div>
<pre><code>                      A: Drug X     B: Placebo    C: Combination
                       (N=134)        (N=134)        (N=132)    
----------------------------------------------------------------
AGE                                                             
  n                      134            134            132      
  Mean (sd)          33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
  IQR                     11            10              10      
  min - max            21 - 50        21 - 62        20 - 69    
SEX                                                             
  F                       79            77              66      
  M                       51            55              60      
  U                       3              2              4       
  UNDIFFERENTIATED        1              0              2       </code></pre>
<p>or for all patients that are older than 18:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">lyt</span>, <span class="no">ADSL</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">AGE</span> <span class="kw">&gt;</span> <span class="fl">18</span>))</pre></body></html></div>
<pre><code>                      A: Drug X     B: Placebo    C: Combination
                       (N=134)        (N=134)        (N=132)    
----------------------------------------------------------------
AGE                                                             
  n                      134            134            132      
  Mean (sd)          33.77 (6.55)   35.43 (7.9)    35.43 (7.72) 
  IQR                     11            10              10      
  min - max            21 - 50        21 - 62        20 - 69    
SEX                                                             
  F                       79            77              66      
  M                       51            55              60      
  U                       3              2              4       
  UNDIFFERENTIATED        1              0              2       </code></pre>
</div>
</div>
<div id="adverse-events" class="section level2">
<h2 class="hasAnchor">
<a href="#adverse-events" class="anchor"></a>Adverse Events</h2>
<p>There are a number of different adverse event tables. We will now present two tables that show adverse events by id and then by grade and by id.</p>
<p>This time we won’t use the <code>ADAE</code> dataset from <code>random.cdisc.data</code> but rather generate a dataset on the fly (see <a href="https://github.com/waddella/phuse2016_adverse_events">Adrian’s 2016 Phuse paper</a>):</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)

<span class="no">lookup</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AEDECOD</span>,                          ~<span class="no">AEBODSYS</span>,                                         ~<span class="no">AETOXGR</span>,
  <span class="st">'HEADACHE'</span>,                        <span class="st">"NERVOUS SYSTEM DISORDERS"</span>,                        <span class="st">"5"</span>,
  <span class="st">'BACK PAIN'</span>,                       <span class="st">"MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS"</span>, <span class="st">"2"</span>,
  <span class="st">'GINGIVAL BLEEDING'</span>,               <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,
  <span class="st">'HYPOTENSION'</span>,                     <span class="st">"VASCULAR DISORDERS"</span>,                              <span class="st">"3"</span>,
  <span class="st">'FAECES SOFT'</span>,                     <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"2"</span>,
  <span class="st">'ABDOMINAL DISCOMFORT'</span>,            <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,
  <span class="st">'DIARRHEA'</span>,                        <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,
  <span class="st">'ABDOMINAL FULLNESS DUE TO GAS'</span>,   <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"1"</span>,
  <span class="st">'NAUSEA (INTERMITTENT)'</span>,           <span class="st">"GASTROINTESTINAL DISORDERS"</span>,                      <span class="st">"2"</span>,
  <span class="st">'WEAKNESS'</span>,                        <span class="st">"MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS"</span>, <span class="st">"3"</span>,
  <span class="st">'ORTHOSTATIC HYPOTENSION'</span>,         <span class="st">"VASCULAR DISORDERS"</span>,                              <span class="st">"4"</span>
)

<span class="no">normalize</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>)
<span class="no">weightsA</span> <span class="kw">&lt;-</span> <span class="fu">normalize</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">5</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">25</span>), <span class="kw">meanlog</span> <span class="kw">=</span> <span class="fl">3</span>)))
<span class="no">weightsB</span> <span class="kw">&lt;-</span> <span class="fu">normalize</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">5</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">25</span>))))

<span class="no">N_pop</span> <span class="kw">&lt;-</span> <span class="fl">300</span>
<span class="no">ADSL2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">USUBJID</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="no">N_pop</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">1</span>),
  <span class="kw">ARM</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'ARM A'</span>, <span class="st">'ARM B'</span>), <span class="no">N_pop</span>, <span class="fl">TRUE</span>),
  <span class="kw">SEX</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'F'</span>, <span class="st">'M'</span>), <span class="no">N_pop</span>, <span class="fl">TRUE</span>),
  <span class="kw">AGE</span> <span class="kw">=</span> <span class="fl">20</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">N_pop</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">40</span>, <span class="kw">prob</span><span class="kw">=</span><span class="fl">0.7</span>)
)

<span class="no">l.adae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="no">ADSL2</span>$<span class="no">USUBJID</span>, <span class="no">ADSL2</span>$<span class="no">ARM</span>, <span class="no">ADSL2</span>$<span class="no">SEX</span>, <span class="no">ADSL2</span>$<span class="no">AGE</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">id</span>, <span class="no">arm</span>, <span class="no">sex</span>, <span class="no">age</span>) {
  <span class="no">n_ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fl">0</span>:<span class="fl">25</span>, <span class="fl">1</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="kw">if</span> (<span class="no">arm</span> <span class="kw">==</span> <span class="st">"ARM A"</span>) <span class="no">weightsA</span> <span class="kw">else</span> <span class="no">weightsB</span>)
  <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">lookup</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="no">n_ae</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">10</span>))/<span class="fl">16</span>)
  <span class="no">lookup</span>[<span class="no">i</span>, ] <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
      <span class="kw">AESEQ</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()),
      <span class="kw">USUBJID</span> <span class="kw">=</span> <span class="no">id</span>, <span class="kw">ARM</span> <span class="kw">=</span> <span class="no">arm</span>, <span class="kw">SEX</span> <span class="kw">=</span> <span class="no">sex</span>, <span class="kw">AGE</span> <span class="kw">=</span> <span class="no">age</span>
    )
}, <span class="kw">SIMPLIFY</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">ADAE2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="no">l.adae</span>)
<span class="no">ADAE2</span> <span class="kw">&lt;-</span> <span class="no">ADAE2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">ARM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">ARM</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ARM A"</span>, <span class="st">"ARM B"</span>)),
    <span class="kw">AEDECOD</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">AEDECOD</span>),
    <span class="kw">AEBODSYS</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">AEBODSYS</span>),
    <span class="kw">AETOXGR</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">AETOXGR</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">1</span>:<span class="fl">5</span>))
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">ARM</span>, <span class="no">AGE</span>, <span class="no">SEX</span>, <span class="no">AESEQ</span>, <span class="no">AEDECOD</span>, <span class="no">AEBODSYS</span>, <span class="no">AETOXGR</span>)

<span class="no">ADAE2</span></pre></body></html></div>
<pre><code># A tibble: 3,118 x 8
   USUBJID ARM     AGE SEX   AESEQ AEDECOD           AEBODSYS            AETOXGR
     &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;int&gt; &lt;fct&gt;             &lt;fct&gt;               &lt;fct&gt;  
 1       1 ARM A    45 F         1 NAUSEA (INTERMIT… GASTROINTESTINAL D… 2      
 2       1 ARM A    45 F         2 HEADACHE          NERVOUS SYSTEM DIS… 5      
 3       1 ARM A    45 F         3 HEADACHE          NERVOUS SYSTEM DIS… 5      
 4       1 ARM A    45 F         4 HEADACHE          NERVOUS SYSTEM DIS… 5      
 5       1 ARM A    45 F         5 HEADACHE          NERVOUS SYSTEM DIS… 5      
 6       1 ARM A    45 F         6 HEADACHE          NERVOUS SYSTEM DIS… 5      
 7       1 ARM A    45 F         7 HEADACHE          NERVOUS SYSTEM DIS… 5      
 8       1 ARM A    45 F         8 HEADACHE          NERVOUS SYSTEM DIS… 5      
 9       1 ARM A    45 F         9 HEADACHE          NERVOUS SYSTEM DIS… 5      
10       1 ARM A    45 F        10 FAECES SOFT       GASTROINTESTINAL D… 2      
# … with 3,108 more rows</code></pre>
<div id="adverse-events-by-id" class="section level3">
<h3 class="hasAnchor">
<a href="#adverse-events-by-id" class="anchor"></a>Adverse Events By ID</h3>
<p>We start by defining an events summary function:</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">s_events_patients</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">labelstr</span>, <span class="no">.N_col</span>) {
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
    <span class="st">"Total number of patients with at least one event"</span> <span class="kw">=</span>
      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">x</span>)) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx (xx.xx%)"</span>),

    <span class="st">"Total number of events"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx"</span>)
  )
}</pre></body></html></div>
<p>So, for a population of <code>5</code> patients where</p>
<ul>
<li>one patient has 2 AEs</li>
<li>one patient has 1 AE</li>
<li>three patients have no AEs</li>
</ul>
<p>we would get the following summary:</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="fu">s_events_patients</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"id 1"</span>, <span class="st">"id 1"</span>, <span class="st">"id 2"</span>), <span class="kw">.N_col</span> <span class="kw">=</span> <span class="fl">5</span>)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
                                          row_name formatted_cell indent_mod
1 Total number of patients with at least one event        2 (40%)          0
2                           Total number of events              3          0
                                         row_label
1 Total number of patients with at least one event
2                           Total number of events</code></pre>
<p>The <code>.N_col</code> argument is a special keyword argument which <code>build_table</code> passes the population size for each respective column. For a list of keyword arguments for the functions passed to <code>afun</code> in <code>analyze</code> refer to the documentation with <code><a href="https://rdrr.io/pkg/rtables/man/analyze.html">?analyze</a></code>.</p>
<p>We now use the <code>s_events_patients</code> summary function in a tabulation:</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"USUBJID"</span>, <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>)</pre></body></html></div>
<pre><code>                                                      ARM A         ARM B    
                                                    (N=2060)       (N=1058)  
-----------------------------------------------------------------------------
Total number of patients with at least one event   114 (5.53%)   150 (14.18%)
Total number of events                                2060           1058    </code></pre>
<p>Note that the column <code>N</code>’s are wrong as by default they are set to the number of rows per group (i.e. number of AEs per arm here). This also affects the percentages. For this table we are interested in the number of patients per column/arm which is usually taken from <code>ADSL</code> (variable <code>ADSL2</code> here):</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">N_per_arm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">ADSL2</span>$<span class="no">ARM</span>)
<span class="no">N_per_arm</span></pre></body></html></div>
<pre><code>
ARM A ARM B 
  146   154 </code></pre>
<p>Since this information is not “pre-data” it needs to go to the table creation function <code>build_table</code>:</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"USUBJID"</span>, <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)</pre></body></html></div>
<pre><code>                                                      ARM A          ARM B   
                                                     (N=146)        (N=154)  
-----------------------------------------------------------------------------
Total number of patients with at least one event   114 (78.08%)   150 (97.4%)
Total number of events                                 2060          1058    </code></pre>
<p>We next calculate this information per system organ class:</p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"USUBJID"</span>, <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEBODSYS"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="st">"USUBJID"</span>, <span class="kw">cfun</span> <span class="kw">=</span> <span class="no">s_events_patients</span>)
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">l</span>, <span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)</pre></body></html></div>
<pre><code>                                                        ARM A          ARM B    
                                                       (N=146)        (N=154)   
--------------------------------------------------------------------------------
Total number of patients with at least one event     114 (78.08%)   150 (97.4%) 
Total number of events                                   2060           1058    
GASTROINTESTINAL DISORDERS                                                      
  Total number of patients with at least one event   114 (78.08%)   130 (84.42%)
  Total number of events                                 760            374     
MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 
  Total number of patients with at least one event   98 (67.12%)     81 (52.6%) 
  Total number of events                                 273            142     
NERVOUS SYSTEM DISORDERS                                                        
  Total number of patients with at least one event   113 (77.4%)    133 (86.36%)
  Total number of events                                 787            420     
VASCULAR DISORDERS                                                              
  Total number of patients with at least one event    93 (63.7%)     75 (48.7%) 
  Total number of events                                 240            122     </code></pre>
<p>We now have to the add a count table of <code>AEDECOD</code> for each <code>AEBODSYS</code>. The default <code>analyze</code> behavior for a factor is to create the count table per level (using <code>rtab_inner</code>):</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">tbl1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEBODSYS"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> <span class="fl">1</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="st">"USUBJID"</span>, <span class="kw">cfun</span> <span class="kw">=</span> <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AEDECOD"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> -<span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)

<span class="no">tbl1</span></pre></body></html></div>
<pre><code>                                                          ARM A          ARM B    
                                                         (N=146)        (N=154)   
----------------------------------------------------------------------------------
  GASTROINTESTINAL DISORDERS                                                      
    Total number of patients with at least one event   114 (78.08%)   130 (84.42%)
    Total number of events                                 760            374     
    ABDOMINAL DISCOMFORT                                   113             65     
    ABDOMINAL FULLNESS DUE TO GAS                          119             65     
    BACK PAIN                                               0              0      
    DIARRHEA                                               107             53     
    FAECES SOFT                                            122             58     
    GINGIVAL BLEEDING                                      147             71     
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                  152             62     
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 
    Total number of patients with at least one event   98 (67.12%)     81 (52.6%) 
    Total number of events                                 273            142     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                              135             75     
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                               138             67     
  NERVOUS SYSTEM DISORDERS                                                        
    Total number of patients with at least one event   113 (77.4%)    133 (86.36%)
    Total number of events                                 787            420     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                               787            420     
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  VASCULAR DISORDERS                                                              
    Total number of patients with at least one event    93 (63.7%)     75 (48.7%) 
    Total number of events                                 240            122     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                            104             58     
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                136             64     
    WEAKNESS                                                0              0      </code></pre>
<p>The <code>indent_mod</code> argument enables relative indenting changes if the tree structure of the table does not result in the desired indentation by default.</p>
<p>This table so far is however not the usual adverse event table as it counts the total number of events and not the number of subjects one or more events for a particular term. To get the correct table we need to write a custom analysis function:</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">table_count_once_per_id</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">termvar</span> <span class="kw">=</span> <span class="st">"AEDECOD"</span>, <span class="no">idvar</span> <span class="kw">=</span> <span class="st">"USUBJID"</span>) {

  <span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="no">termvar</span>]]
  <span class="no">id</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="no">idvar</span>]]

  <span class="no">counts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">x</span>[!<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">id</span>)])

  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
    <span class="kw">.list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">counts</span>),
    <span class="kw">.labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">counts</span>)
  )
}

<span class="fu">table_count_once_per_id</span>(<span class="no">ADAE2</span>)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
                        row_name formatted_cell indent_mod
1           ABDOMINAL DISCOMFORT             23          0
2  ABDOMINAL FULLNESS DUE TO GAS             21          0
3                      BACK PAIN             20          0
4                       DIARRHEA              7          0
5                    FAECES SOFT             11          0
6              GINGIVAL BLEEDING             15          0
7                       HEADACHE            100          0
8                    HYPOTENSION             16          0
9          NAUSEA (INTERMITTENT)             21          0
10       ORTHOSTATIC HYPOTENSION             14          0
11                      WEAKNESS             16          0
                       row_label
1           ABDOMINAL DISCOMFORT
2  ABDOMINAL FULLNESS DUE TO GAS
3                      BACK PAIN
4                       DIARRHEA
5                    FAECES SOFT
6              GINGIVAL BLEEDING
7                       HEADACHE
8                    HYPOTENSION
9          NAUSEA (INTERMITTENT)
10       ORTHOSTATIC HYPOTENSION
11                      WEAKNESS</code></pre>
<p>So the desired AE table is:</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEBODSYS"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> <span class="fl">1</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="st">"USUBJID"</span>, <span class="kw">cfun</span> <span class="kw">=</span> <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AEDECOD"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">table_count_once_per_id</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> -<span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)</pre></body></html></div>
<pre><code>                                                          ARM A          ARM B    
                                                         (N=146)        (N=154)   
----------------------------------------------------------------------------------
  GASTROINTESTINAL DISORDERS                                                      
    Total number of patients with at least one event   114 (78.08%)   130 (84.42%)
    Total number of events                                 760            374     
    ABDOMINAL DISCOMFORT                                    24             28     
    ABDOMINAL FULLNESS DUE TO GAS                           18             26     
    BACK PAIN                                               0              0      
    DIARRHEA                                                17             17     
    FAECES SOFT                                             17             14     
    GINGIVAL BLEEDING                                       18             25     
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   20             20     
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 
    Total number of patients with at least one event   98 (67.12%)     81 (52.6%) 
    Total number of events                                 273            142     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               58             45     
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                40             36     
  NERVOUS SYSTEM DISORDERS                                                        
    Total number of patients with at least one event   113 (77.4%)    133 (86.36%)
    Total number of events                                 787            420     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                               113            133     
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  VASCULAR DISORDERS                                                              
    Total number of patients with at least one event    93 (63.7%)     75 (48.7%) 
    Total number of events                                 240            122     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                             44             31     
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 49             44     
    WEAKNESS                                                0              0      </code></pre>
<p>Note that we are missing the overall summary in the first two rows. This can be added with another <code>analyze</code> call and then setting <code>nested</code> to <code>FALSE</code> in the subsequent <code>summarize_row_groups</code> call:</p>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="no">tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"USUBJID"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEBODSYS"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> <span class="fl">1</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="st">"USUBJID"</span>, <span class="kw">cfun</span> <span class="kw">=</span> <span class="no">s_events_patients</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AEDECOD"</span>, <span class="no">table_count_once_per_id</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> -<span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)

<span class="no">tbl</span></pre></body></html></div>
<pre><code>                                                          ARM A          ARM B    
                                                         (N=146)        (N=154)   
----------------------------------------------------------------------------------
Total number of patients with at least one event       114 (78.08%)   150 (97.4%) 
Total number of events                                     2060           1058    
  GASTROINTESTINAL DISORDERS                                                      
    Total number of patients with at least one event   114 (78.08%)   130 (84.42%)
    Total number of events                                 760            374     
    ABDOMINAL DISCOMFORT                                    24             28     
    ABDOMINAL FULLNESS DUE TO GAS                           18             26     
    BACK PAIN                                               0              0      
    DIARRHEA                                                17             17     
    FAECES SOFT                                             17             14     
    GINGIVAL BLEEDING                                       18             25     
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   20             20     
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 
    Total number of patients with at least one event   98 (67.12%)     81 (52.6%) 
    Total number of events                                 273            142     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               58             45     
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                40             36     
  NERVOUS SYSTEM DISORDERS                                                        
    Total number of patients with at least one event   113 (77.4%)    133 (86.36%)
    Total number of events                                 787            420     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                               113            133     
    HYPOTENSION                                             0              0      
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 0              0      
    WEAKNESS                                                0              0      
  VASCULAR DISORDERS                                                              
    Total number of patients with at least one event    93 (63.7%)     75 (48.7%) 
    Total number of events                                 240            122     
    ABDOMINAL DISCOMFORT                                    0              0      
    ABDOMINAL FULLNESS DUE TO GAS                           0              0      
    BACK PAIN                                               0              0      
    DIARRHEA                                                0              0      
    FAECES SOFT                                             0              0      
    GINGIVAL BLEEDING                                       0              0      
    HEADACHE                                                0              0      
    HYPOTENSION                                             44             31     
    NAUSEA (INTERMITTENT)                                   0              0      
    ORTHOSTATIC HYPOTENSION                                 49             44     
    WEAKNESS                                                0              0      </code></pre>
<p>Finally, if we wanted to prune the 0 counts row we can do that with the <code>trim_rows</code> function:</p>
<div class="sourceCode" id="cb66"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/trim_rows.html">trim_rows</a></span>(<span class="no">tbl</span>)</pre></body></html></div>
<pre><code>                                                          ARM A          ARM B    
                                                         (N=146)        (N=154)   
----------------------------------------------------------------------------------
Total number of patients with at least one event       114 (78.08%)   150 (97.4%) 
Total number of events                                     2060           1058    
  GASTROINTESTINAL DISORDERS                                                      
    Total number of patients with at least one event   114 (78.08%)   130 (84.42%)
    Total number of events                                 760            374     
    ABDOMINAL DISCOMFORT                                    24             28     
    ABDOMINAL FULLNESS DUE TO GAS                           18             26     
    DIARRHEA                                                17             17     
    FAECES SOFT                                             17             14     
    GINGIVAL BLEEDING                                       18             25     
    NAUSEA (INTERMITTENT)                                   20             20     
  MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                                 
    Total number of patients with at least one event   98 (67.12%)     81 (52.6%) 
    Total number of events                                 273            142     
    BACK PAIN                                               58             45     
    WEAKNESS                                                40             36     
  NERVOUS SYSTEM DISORDERS                                                        
    Total number of patients with at least one event   113 (77.4%)    133 (86.36%)
    Total number of events                                 787            420     
    HEADACHE                                               113            133     
  VASCULAR DISORDERS                                                              
    Total number of patients with at least one event    93 (63.7%)     75 (48.7%) 
    Total number of events                                 240            122     
    HYPOTENSION                                             44             31     
    ORTHOSTATIC HYPOTENSION                                 49             44     </code></pre>
<p>Pruning is a larger topic with a separate <code>rtables</code> package vignette.</p>
</div>
<div id="adverse-events-by-id-and-by-grade" class="section level3">
<h3 class="hasAnchor">
<a href="#adverse-events-by-id-and-by-grade" class="anchor"></a>Adverse Events By ID and By Grade</h3>
<p>The adverse events table by ID and by grade shows how many patients had at least one adverse event per grade for different subsets of the data (e.g. defined by system organ class).</p>
<p>For this table we do not show the zero count grades. Note that we add the “overall” groups with a custom split function.</p>
<div class="sourceCode" id="cb68"><html><body><pre class="r"><span class="no">table_count_grade_once_per_id</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">labelstr</span> <span class="kw">=</span> <span class="st">""</span>, <span class="no">gradevar</span> <span class="kw">=</span> <span class="st">"AETOXGR"</span>, <span class="no">idvar</span> <span class="kw">=</span> <span class="st">"USUBJID"</span>, <span class="no">grade_levels</span> <span class="kw">=</span> <span class="kw">NULL</span>) {

  <span class="no">id</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="no">idvar</span>]]
  <span class="no">grade</span> <span class="kw">&lt;-</span> <span class="no">df</span><span class="kw">[[</span><span class="no">gradevar</span>]]

  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">grade_levels</span>)) {
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">grade</span> <span class="kw">%in%</span> <span class="no">grade_levels</span>))
    <span class="no">grade</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">grade</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="no">grade_levels</span>)
  }

  <span class="no">id_sel</span> <span class="kw">&lt;-</span> !<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">id</span>)

  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="st">"--Any Grade--"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">id_sel</span>),
      <span class="kw">.list</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">grade</span>[<span class="no">id_sel</span>]))
    )
}

<span class="fu">table_count_grade_once_per_id</span>(<span class="no">ex_adae</span>, <span class="kw">grade_levels</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
       row_name formatted_cell indent_mod     row_label
1 --Any Grade--            365          0 --Any Grade--
2             1            131          0             1
3             2             70          0             2
4             3             74          0             3
5             4             25          0             4
6             5             65          0             5</code></pre>
<p>All of the layouting concepts needed to create this table have already been introduced so far:</p>
<div class="sourceCode" id="cb70"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARM"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AETOXGR"</span>,
          <span class="kw">afun</span> <span class="kw">=</span> <span class="no">table_count_grade_once_per_id</span>,
          <span class="kw">extra_args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">grade_levels</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>),
          <span class="kw">var_labels</span> <span class="kw">=</span> <span class="st">"- Any adverse events -"</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEBODSYS"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="kw">cfun</span> <span class="kw">=</span> <span class="no">table_count_grade_once_per_id</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(<span class="st">"AEDECOD"</span>, <span class="kw">child_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">indent_mod</span> <span class="kw">=</span> -<span class="fl">2</span>)  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AETOXGR"</span>,
          <span class="kw">afun</span> <span class="kw">=</span> <span class="no">table_count_grade_once_per_id</span>,
          <span class="kw">extra_args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">grade_levels</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">5</span>), <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADAE2</span>, <span class="kw">col_counts</span> <span class="kw">=</span> <span class="no">N_per_arm</span>)</pre></body></html></div>
<pre><code>                                                     ARM A     ARM B 
                                                    (N=146)   (N=154)
---------------------------------------------------------------------
- Any adverse events -                                               
  --Any Grade--                                       114       150  
  1                                                   32        34   
  2                                                   22        30   
  3                                                   11        21   
  4                                                    8         6   
  5                                                   41        59   
  GASTROINTESTINAL DISORDERS                                         
        --Any Grade--                                 114       130  
        1                                             77        96   
        2                                             37        34   
        3                                              0         0   
        4                                              0         0   
        5                                              0         0   
    ABDOMINAL DISCOMFORT                                             
      --Any Grade--                                   68        49   
      1                                               68        49   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ABDOMINAL FULLNESS DUE TO GAS                                    
      --Any Grade--                                   73        51   
      1                                               73        51   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    BACK PAIN                                                        
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    DIARRHEA                                                         
      --Any Grade--                                   68        40   
      1                                               68        40   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    FAECES SOFT                                                      
      --Any Grade--                                   76        44   
      1                                                0         0   
      2                                               76        44   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    GINGIVAL BLEEDING                                                
      --Any Grade--                                   80        52   
      1                                               80        52   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HEADACHE                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HYPOTENSION                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    NAUSEA (INTERMITTENT)                                            
      --Any Grade--                                   83        50   
      1                                                0         0   
      2                                               83        50   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ORTHOSTATIC HYPOTENSION                                          
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    WEAKNESS                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
  MUSCULOSKELETAL AND CONNECTIVE TISSUE DISORDERS                    
        --Any Grade--                                 98        81   
        1                                              0         0   
        2                                             58        45   
        3                                             40        36   
        4                                              0         0   
        5                                              0         0   
    ABDOMINAL DISCOMFORT                                             
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ABDOMINAL FULLNESS DUE TO GAS                                    
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    BACK PAIN                                                        
      --Any Grade--                                   79        62   
      1                                                0         0   
      2                                               79        62   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    DIARRHEA                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    FAECES SOFT                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    GINGIVAL BLEEDING                                                
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HEADACHE                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HYPOTENSION                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    NAUSEA (INTERMITTENT)                                            
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ORTHOSTATIC HYPOTENSION                                          
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    WEAKNESS                                                         
      --Any Grade--                                   73        43   
      1                                                0         0   
      2                                                0         0   
      3                                               73        43   
      4                                                0         0   
      5                                                0         0   
  NERVOUS SYSTEM DISORDERS                                           
        --Any Grade--                                 113       133  
        1                                              0         0   
        2                                              0         0   
        3                                              0         0   
        4                                              0         0   
        5                                             113       133  
    ABDOMINAL DISCOMFORT                                             
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ABDOMINAL FULLNESS DUE TO GAS                                    
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    BACK PAIN                                                        
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    DIARRHEA                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    FAECES SOFT                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    GINGIVAL BLEEDING                                                
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HEADACHE                                                         
      --Any Grade--                                   113       133  
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                               113       133  
    HYPOTENSION                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    NAUSEA (INTERMITTENT)                                            
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ORTHOSTATIC HYPOTENSION                                          
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    WEAKNESS                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
  VASCULAR DISORDERS                                                 
        --Any Grade--                                 93        75   
        1                                              0         0   
        2                                              0         0   
        3                                             44        31   
        4                                             49        44   
        5                                              0         0   
    ABDOMINAL DISCOMFORT                                             
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ABDOMINAL FULLNESS DUE TO GAS                                    
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    BACK PAIN                                                        
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    DIARRHEA                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    FAECES SOFT                                                      
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    GINGIVAL BLEEDING                                                
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HEADACHE                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    HYPOTENSION                                                      
      --Any Grade--                                   66        43   
      1                                                0         0   
      2                                                0         0   
      3                                               66        43   
      4                                                0         0   
      5                                                0         0   
    NAUSEA (INTERMITTENT)                                            
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   
    ORTHOSTATIC HYPOTENSION                                          
      --Any Grade--                                   70        54   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                               70        54   
      5                                                0         0   
    WEAKNESS                                                         
      --Any Grade--                                    0         0   
      1                                                0         0   
      2                                                0         0   
      3                                                0         0   
      4                                                0         0   
      5                                                0         0   </code></pre>
</div>
</div>
<div id="response-table" class="section level2">
<h2 class="hasAnchor">
<a href="#response-table" class="anchor"></a>Response Table</h2>
<p>The response table that we will create here is composed of 3 parts:</p>
<ol style="list-style-type: decimal">
<li>Binary response table</li>
<li>Unstratified analysis comparison vs. control group</li>
<li>Multinomial response table</li>
</ol>
<p>Let’s start with the first part which is fairly simple to derive:</p>
<div class="sourceCode" id="cb72"><html><body><pre class="r"><span class="no">ADRS_BESRSPI</span> <span class="kw">&lt;-</span> <span class="no">ex_adrs</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span> <span class="kw">==</span> <span class="st">"BESRSPI"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">rsp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">AVALC</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CR"</span>, <span class="st">"PR"</span>), <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>, <span class="fl">FALSE</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Responders"</span>, <span class="st">"Non-Responders"</span>)),
    <span class="kw">is_rsp</span> <span class="kw">=</span> (<span class="no">rsp</span> <span class="kw">==</span> <span class="st">"Responders"</span>)
  )

<span class="no">s_proportion</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.N_col</span>) {
   <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(<span class="kw">.list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">x</span>)), <span class="kw">function</span>(<span class="no">xi</span>) <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="no">xi</span> * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx%)"</span>)))
}

<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARMCD"</span>, <span class="kw">ref_group</span> <span class="kw">=</span> <span class="st">"ARM A"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"rsp"</span>, <span class="no">s_proportion</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADRS_BESRSPI</span>)</pre></body></html></div>
<pre><code>                    ARM A          ARM B         ARM C    
                   (N=134)        (N=134)       (N=132)   
----------------------------------------------------------
Responders       114 (85.07%)   90 (67.16%)   120 (90.91%)
Non-Responders   20 (14.93%)    44 (32.84%)    12 (9.09%) </code></pre>
<p>Note that we did set the <code>ref_group</code> argument in <code>split_cols_by</code> which for the current table had no effect as we only use the cell data for the responder and non-responder counting. The <code>ref_group</code> argument is needed for the part 2. and 3. of the table.</p>
<p>We will now look the implementation of part “2. Unstratified analysis comparison vs. control group.” Let’s start with the analysis function:</p>
<div class="sourceCode" id="cb74"><html><body><pre class="r"><span class="no">s_unstratified_response_analysis</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.ref_group</span>, <span class="no">.in_ref_col</span>) {

  <span class="kw">if</span> (<span class="no">.in_ref_col</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
        <span class="st">"Difference in Response Rates (%)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fl">0</span>)),
        <span class="st">"95% CI (Wald, with correction)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fl">0</span>)),
        <span class="st">"p-value (Chi-Squared Test)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fl">0</span>)),
        <span class="st">"Odds Ratio (95% CI)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fl">0</span>))
    ))
  }

  <span class="no">fit</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">.ref_group</span>)),
    <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>), <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.ref_group</span>)),
    <span class="kw">correct</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )

  <span class="no">fit_glm</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(
    <span class="kw">formula</span> <span class="kw">=</span> <span class="no">rsp</span> ~ <span class="no">group</span>,
    <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
      <span class="kw">rsp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">.ref_group</span>, <span class="no">x</span>),
      <span class="kw">group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ref"</span>, <span class="st">"x"</span>), <span class="kw">times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">.ref_group</span>), <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>))), <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ref"</span>, <span class="st">"x"</span>))
    ),
    <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(<span class="kw">link</span> <span class="kw">=</span> <span class="st">"logit"</span>)
  )

  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
      <span class="st">"Difference in Response Rates (%)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">non_ref_rcell</a></span>((<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>) - <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">.ref_group</span>)) * <span class="fl">100</span>,
                                                         <span class="no">.in_ref_col</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx"</span>) ,
      <span class="st">"95% CI (Wald, with correction)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">non_ref_rcell</a></span>(<span class="no">fit</span>$<span class="no">conf.int</span> * <span class="fl">100</span>,
                                                       <span class="no">.in_ref_col</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"(xx.xx, xx.xx)"</span>),
      <span class="st">"p-value (Chi-Squared Test)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">non_ref_rcell</a></span>(<span class="no">fit</span>$<span class="no">p.value</span>,
                                                   <span class="no">.in_ref_col</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"x.xxxx | (&lt;0.0001)"</span>),
      <span class="st">"Odds Ratio (95% CI)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">non_ref_rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
          <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">fit_glm</span>)[-<span class="fl">1</span>]),
          <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span>(<span class="no">fit_glm</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="fl">.95</span>)[-<span class="fl">1</span>, , <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">FALSE</span>])
      ),
      <span class="no">.in_ref_col</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx - xx.xx)"</span>)
  )
}

<span class="fu">s_unstratified_response_analysis</span>(
  <span class="kw">x</span> <span class="kw">=</span> <span class="no">ADRS_BESRSPI</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ARM</span> <span class="kw">==</span> <span class="st">"A: Drug X"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">is_rsp</span>),
  <span class="kw">.ref_group</span> <span class="kw">=</span> <span class="no">ADRS_BESRSPI</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ARM</span> <span class="kw">==</span> <span class="st">"B: Placebo"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">is_rsp</span>),
  <span class="kw">.in_ref_col</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
                          row_name     formatted_cell indent_mod
1 Difference in Response Rates (%)              17.91          0
2   95% CI (Wald, with correction)      (7.93, 27.89)          0
3       p-value (Chi-Squared Test)             0.0006          0
4              Odds Ratio (95% CI) 2.79 (1.53 - 5.06)          0
                         row_label
1 Difference in Response Rates (%)
2   95% CI (Wald, with correction)
3       p-value (Chi-Squared Test)
4              Odds Ratio (95% CI)</code></pre>
<p>Hence we can now add the next vignette to the table:</p>
<div class="sourceCode" id="cb76"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARMCD"</span>, <span class="kw">ref_group</span> <span class="kw">=</span> <span class="st">"ARM A"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"rsp"</span>, <span class="no">s_proportion</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"is_rsp"</span>, <span class="no">s_unstratified_response_analysis</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">var_labels</span> <span class="kw">=</span> <span class="st">"Unstratified Response Analysis"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADRS_BESRSPI</span>)</pre></body></html></div>
<pre><code>                                        ARM A             ARM B               ARM C       
                                       (N=134)           (N=134)             (N=132)      
------------------------------------------------------------------------------------------
Responders                           114 (85.07%)      90 (67.16%)         120 (90.91%)   
Non-Responders                       20 (14.93%)       44 (32.84%)          12 (9.09%)    
Unstratified Response Analysis                                                            
  Difference in Response Rates (%)                       -17.91                5.83       
  95% CI (Wald, with correction)                     (-27.89, -7.93)      (-1.94, 13.61)  
  p-value (Chi-Squared Test)                             0.0006               0.1436      
  Odds Ratio (95% CI)                               0.36 (0.2 - 0.65)   1.75 (0.82 - 3.75)</code></pre>
<p>Next we will add part 3. the “multinomial response table”. To do so, we are adding a row-split by response level, and then doing the same thing as we did for the binary response table above.</p>
<div class="sourceCode" id="cb78"><html><body><pre class="r"><span class="no">s_prop</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">.N_col</span>) {
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(
    <span class="st">"95% CI (Wald, with correction)"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df</span>), <span class="no">.N_col</span>)$<span class="no">conf.int</span> * <span class="fl">100</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"(xx.xx, xx.xx)"</span>)
  )
}

<span class="fu">s_prop</span>(
  <span class="kw">df</span> <span class="kw">=</span> <span class="no">ADRS_BESRSPI</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">ARM</span> <span class="kw">==</span> <span class="st">"A: Drug X"</span>, <span class="no">AVALC</span> <span class="kw">==</span> <span class="st">"CR"</span>),
  <span class="kw">.N_col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">ADRS_BESRSPI</span>$<span class="no">ARM</span> <span class="kw">==</span> <span class="st">"A: Drug X"</span>)
)</pre></body></html></div>
<pre><code>RowsVerticalSection (in_rows) object print method:
----------------------------
                        row_name formatted_cell indent_mod
1 95% CI (Wald, with correction) (49.38, 66.67)          0
                       row_label
1 95% CI (Wald, with correction)</code></pre>
<p>We can now create the final response table with all three parts:</p>
<div class="sourceCode" id="cb80"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARMCD"</span>, <span class="kw">ref_group</span> <span class="kw">=</span> <span class="st">"ARM A"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"rsp"</span>, <span class="no">s_proportion</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"is_rsp"</span>, <span class="no">s_unstratified_response_analysis</span>,
          <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">var_labels</span> <span class="kw">=</span> <span class="st">"Unstratified Response Analysis"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(
    <span class="kw">var</span> <span class="kw">=</span> <span class="st">"AVALC"</span>,
    <span class="kw">split_fun</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_funcs.html">reorder_split_levels</a></span>(<span class="kw">neworder</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"SD"</span>, <span class="st">"NON CR/PD"</span>, <span class="st">"PD"</span>, <span class="st">"NE"</span>), <span class="kw">drlevels</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AVALC"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_prop</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADRS_BESRSPI</span>)</pre></body></html></div>
<pre><code>                                         ARM A              ARM B               ARM C       
                                        (N=134)            (N=134)             (N=132)      
--------------------------------------------------------------------------------------------
Responders                            114 (85.07%)       90 (67.16%)         120 (90.91%)   
Non-Responders                        20 (14.93%)        44 (32.84%)          12 (9.09%)    
Unstratified Response Analysis                                                              
  Difference in Response Rates (%)                         -17.91                5.83       
  95% CI (Wald, with correction)                       (-27.89, -7.93)      (-1.94, 13.61)  
  p-value (Chi-Squared Test)                               0.0006               0.1436      
  Odds Ratio (95% CI)                                 0.36 (0.2 - 0.65)   1.75 (0.82 - 3.75)
CR                                     78 (58.2%)         55 (41%)            97 (73.5%)    
  95% CI (Wald, with correction)     (49.38, 66.67)    (32.63, 49.87)       (65.1, 80.79)   
PR                                     36 (26.9%)        35 (26.1%)           23 (17.4%)    
  95% CI (Wald, with correction)     (19.58, 35.2)     (18.92, 34.41)       (11.38, 24.99)  
SD                                     20 (14.9%)        44 (32.8%)           12 (9.1%)     
  95% CI (Wald, with correction)     (9.36, 22.11)     (24.97, 41.47)       (4.79, 15.34)   </code></pre>
<p>In case the we wanted to rename the levels of <code>AVALC</code> and remove the CI for <code>NE</code> we could do that as follows:</p>
<div class="sourceCode" id="cb82"><html><body><pre class="r"><span class="no">rsp_label</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="no">rsp_full_label</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="kw">CR</span>          <span class="kw">=</span> <span class="st">"Complete Response (CR)"</span>,
    <span class="kw">PR</span>          <span class="kw">=</span> <span class="st">"Partial Response (PR)"</span>,
    <span class="kw">SD</span>          <span class="kw">=</span> <span class="st">"Stable Disease (SD)"</span>,
    <span class="kw">`NON CR/PD`</span> <span class="kw">=</span> <span class="st">"Non-CR or Non-PD (NON CR/PD)"</span>,
    <span class="kw">PD</span>          <span class="kw">=</span> <span class="st">"Progressive Disease (PD)"</span>,
    <span class="kw">NE</span>          <span class="kw">=</span> <span class="st">"Not Evaluable (NE)"</span>,
    <span class="kw">Missing</span>     <span class="kw">=</span> <span class="st">"Missing"</span>,
    <span class="kw">`NE/Missing`</span> <span class="kw">=</span> <span class="st">"Missing or unevaluable"</span>
  )
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="no">x</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">rsp_full_label</span>)))
  <span class="no">rsp_full_label</span>[<span class="no">x</span>]
}


<span class="no">tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html">basic_table</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html">split_cols_by</a></span>(<span class="st">"ARMCD"</span>, <span class="kw">ref_group</span> <span class="kw">=</span> <span class="st">"ARM A"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/add_colcounts.html">add_colcounts</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"rsp"</span>, <span class="no">s_proportion</span>, <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"hidden"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"is_rsp"</span>, <span class="no">s_unstratified_response_analysis</span>,
          <span class="kw">show_labels</span> <span class="kw">=</span> <span class="st">"visible"</span>, <span class="kw">var_labels</span> <span class="kw">=</span> <span class="st">"Unstratified Response Analysis"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html">split_rows_by</a></span>(
    <span class="kw">var</span> <span class="kw">=</span> <span class="st">"AVALC"</span>,
    <span class="kw">split_fun</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_funcs.html">keep_split_levels</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"SD"</span>, <span class="st">"PD"</span>), <span class="kw">reorder</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/summarize_row_groups.html">summarize_row_groups</a></span>(<span class="kw">cfun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">df</span>, <span class="no">labelstr</span>, <span class="no">.N_col</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">df</span>) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">.formats</span> <span class="kw">=</span> <span class="st">"xx (xx.xx%)"</span>, <span class="kw">.labels</span> <span class="kw">=</span> <span class="fu">rsp_label</span>(<span class="no">labelstr</span>))
  }) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AVALC"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="no">s_prop</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/analyze.html">analyze</a></span>(<span class="st">"AVALC"</span>, <span class="kw">afun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">.N_col</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/in_rows.html">in_rows</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/rtables/man/rcell.html">rcell</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span> <span class="kw">==</span> <span class="st">"NE"</span>) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>/<span class="no">.N_col</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"xx.xx (xx.xx%)"</span>), <span class="kw">.labels</span> <span class="kw">=</span> <span class="fu">rsp_label</span>(<span class="st">"NE"</span>))
  }, <span class="kw">nested</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html">build_table</a></span>(<span class="no">ADRS_BESRSPI</span>)

<span class="no">tbl</span></pre></body></html></div>
<pre><code>                                         ARM A              ARM B               ARM C       
                                        (N=134)            (N=134)             (N=132)      
--------------------------------------------------------------------------------------------
Responders                            114 (85.07%)       90 (67.16%)         120 (90.91%)   
Non-Responders                        20 (14.93%)        44 (32.84%)          12 (9.09%)    
Unstratified Response Analysis                                                              
  Difference in Response Rates (%)                         -17.91                5.83       
  95% CI (Wald, with correction)                       (-27.89, -7.93)      (-1.94, 13.61)  
  p-value (Chi-Squared Test)                               0.0006               0.1436      
  Odds Ratio (95% CI)                                 0.36 (0.2 - 0.65)   1.75 (0.82 - 3.75)
Complete Response (CR)                78 (58.21%)        55 (41.04%)         97 (73.48%)    
  95% CI (Wald, with correction)     (49.38, 66.67)    (32.63, 49.87)       (65.1, 80.79)   
Partial Response (PR)                 36 (26.87%)        35 (26.12%)         23 (17.42%)    
  95% CI (Wald, with correction)     (19.58, 35.2)     (18.92, 34.41)       (11.38, 24.99)  
Stable Disease (SD)                   20 (14.93%)        44 (32.84%)          12 (9.09%)    
  95% CI (Wald, with correction)     (9.36, 22.11)     (24.97, 41.47)       (4.79, 15.34)   
Progressive Disease (PD)                 0 (0%)            0 (0%)               0 (0%)      
  95% CI (Wald, with correction)       (0, 2.72)          (0, 2.72)           (0, 2.76)     
Not Evaluable (NE)                       0 (0%)            0 (0%)               0 (0%)      </code></pre>
<p>Note that the table is missing the rows gaps to make it more readable. The row spacing feature is on the <code>rtables</code> roadmap and will be implemented in future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gabriel Becker, Adrian Waddell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
